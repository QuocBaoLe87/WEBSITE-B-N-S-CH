<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Quản lý Người dùng</title>
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <meta name="_csrf" th:content="${_csrf.token}" />
    <meta name="_csrf_header" th:content="${_csrf.headerName}" />
    <style>
      /* ===== CSS Variables - Bookstore Theme ===== */
      :root {
        --primary-color: #8b6f47;
        --primary-dark: #6b5535;
        --primary-light: #d4a574;
        --text-muted: #9b8b7e;
        --warm-bg: #faf8f3;
        --border: #e5d5c0;
        --shadow: 0 10px 15px -3px rgba(139, 111, 71, 0.15);
        --transition: all 0.3s ease;
      }

      body {
        background: linear-gradient(
          135deg,
          var(--warm-bg) 0%,
          #ffffff 50%,
          rgba(218, 165, 32, 0.03) 100%
        );
        padding-top: 72px;
        font-family: "Poppins", sans-serif;
      }

      .navbar {
        background: linear-gradient(
          90deg,
          var(--primary-color),
          var(--primary-dark)
        ) !important;
        box-shadow: var(--shadow);
        border-bottom: 2px solid rgba(218, 165, 32, 0.2);
      }

      .navbar-brand {
        font-weight: 700;
        letter-spacing: 1px;
        color: #fff !important;
        font-size: 1.3rem;
      }

      .navbar .btn-outline-light {
        border-color: rgba(255, 255, 255, 0.6);
        color: #fff;
        transition: var(--transition);
      }

      .navbar .btn-outline-light:hover {
        background: rgba(255, 255, 255, 0.15);
        border-color: rgba(255, 255, 255, 0.3);
        transform: translateY(-2px);
      }

      .card {
        border: 1px solid var(--border) !important;
        border-radius: 1.5rem;
        box-shadow: var(--shadow);
        transition: var(--transition);
      }

      .card:hover {
        box-shadow: 0 20px 25px -5px rgba(139, 111, 71, 0.2);
        transform: translateY(-2px);
      }

      .card-header {
        background: linear-gradient(
          90deg,
          var(--primary-color),
          var(--primary-dark)
        );
        border-radius: 1.5rem 1.5rem 0 0 !important;
        border-bottom: 0;
        color: white;
      }

      .card-header i {
        color: #ffc107;
      }

      .card-header h4,
      .card-header p {
        color: white;
      }

      .table {
        margin-bottom: 0;
        background: white;
      }

      .table th {
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.85rem;
        letter-spacing: 0.025em;
        background: transparent;
        color: var(--primary-dark);
        border-bottom: 2px solid var(--border);
      }

      .table th i {
        color: var(--primary-color);
      }

      .table-hover tbody tr:hover {
        background-color: rgba(212, 165, 116, 0.05);
      }

      .btn-primary {
        background: linear-gradient(
          90deg,
          var(--primary-color),
          var(--primary-dark)
        );
        border: none;
        color: white;
      }

      .btn-primary:hover {
        background: linear-gradient(
          90deg,
          var(--primary-dark),
          var(--primary-color)
        );
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(139, 111, 71, 0.3);
        color: white;
      }

      .btn-light {
        background: var(--warm-bg);
        border-color: var(--border);
        color: var(--primary-dark);
      }

      .btn-light:hover {
        background: var(--border);
        color: var(--primary-dark);
      }

      .btn-outline-primary {
        color: var(--primary-color);
        border-color: var(--primary-color);
      }

      .btn-outline-primary:hover {
        background: var(--primary-color);
        border-color: var(--primary-color);
        color: white;
      }

      .btn-outline-danger {
        color: #dc2626;
        border-color: #dc2626;
      }

      .btn-outline-danger:hover {
        background: #dc2626;
        border-color: #dc2626;
        color: white;
      }

      .badge {
        padding: 0.5em 0.75em;
        font-weight: 500;
      }

      .badge.bg-primary {
        background: var(--primary-color) !important;
        color: white;
      }

      .badge.bg-success {
        background: #10b981 !important;
        color: white;
      }

      .badge.bg-danger {
        background: #ef4444 !important;
        color: white;
      }

      .alert {
        border: none;
        border-radius: 0.75rem;
        border-left: 4px solid;
      }

      .alert-success {
        background: #ecfdf5;
        color: #059669;
        border-left-color: #10b981;
      }

      .alert-danger {
        background: #fee2e2;
        color: #dc2626;
        border-left-color: #ef4444;
      }

      .table-responsive {
        border-radius: 1rem;
        background: white;
      }

      .user-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--primary-dark)
        );
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        font-size: 0.9rem;
      }

      .status-badge {
        padding: 0.4rem 0.8rem;
        border-radius: 0.5rem;
        font-size: 0.85rem;
        font-weight: 600;
      }

      .status-active {
        background: #ecfdf5;
        color: #059669;
      }

      .status-inactive {
        background: #fee2e2;
        color: #dc2626;
      }
    </style>
  </head>

  <body>
    <!-- ===== NAVBAR ===== -->
    <nav class="navbar navbar-expand-lg navbar-dark mb-4 fixed-top">
      <div class="container-lg">
        <a class="navbar-brand" th:href="@{/admin/dashboard}"> ADMIN </a>

        <div class="ms-auto d-flex align-items-center gap-2">
          <a
            class="btn btn-outline-light"
            th:href="@{/admin/dashboard}"
            title="Dashboard"
          >
            <i class="fas fa-tachometer-alt"></i>
          </a>
          <a class="btn btn-outline-light" th:href="@{/}" title="Trang chủ">
            <i class="fas fa-home"></i>
          </a>
          <form th:action="@{/logout}" method="post" class="d-inline">
            <input
              type="hidden"
              th:name="${_csrf.parameterName}"
              th:value="${_csrf.token}"
            />
            <button
              type="submit"
              class="btn btn-outline-light"
              title="Đăng xuất"
            >
              <i class="fas fa-sign-out-alt"></i>
            </button>
          </form>
        </div>
      </div>
    </nav>

    <div class="container-lg mt-4">
      <!-- Header -->
      <div
        class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-3"
      >
        <div>
          <h3 class="mb-1">
            <i
              class="fas fa-user-group me-2"
              style="color: var(--primary-color)"
            ></i>
            Quản lý Người dùng
          </h3>
          <p class="text-muted small mb-0">
            <i class="fas fa-info-circle me-1"></i>
            Quản lý tài khoản người dùng và phân quyền
          </p>
        </div>
        <a th:href="@{/admin/user/new}" class="btn btn-primary">
          <i class="fas fa-plus-circle me-2"></i>
          Thêm người dùng
        </a>
      </div>

      <!-- Alerts -->
      <div
        th:if="${message}"
        class="alert alert-success alert-dismissible fade show"
        role="alert"
      >
        <i class="fas fa-check-circle me-2"></i>
        <span th:text="${message}"></span>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="alert"
        ></button>
      </div>

      <div
        th:if="${error}"
        class="alert alert-danger alert-dismissible fade show"
        role="alert"
      >
        <i class="fas fa-exclamation-circle me-2"></i>
        <span th:text="${error}"></span>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="alert"
        ></button>
      </div>

      <!-- Users Table Card -->
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="fas fa-list me-2"></i>
            Danh sách Người dùng
          </h5>
        </div>

        <div class="table-responsive">
          <table class="table table-hover align-middle">
            <thead>
              <tr>
                <th style="width: 50px">#</th>
                <th><i class="fas fa-user me-2"></i>Người dùng</th>
                <th><i class="fas fa-envelope me-2"></i>Email</th>
                <th><i class="fas fa-phone me-2"></i>Số điện thoại</th>
                <th style="width: 100px" class="text-center">
                  <i class="fas fa-shield me-2"></i>Vai trò
                </th>
                <th style="width: 100px" class="text-center">
                  <i class="fas fa-toggle-on me-2"></i>Trạng thái
                </th>
                <th style="width: 180px" class="text-end pe-4">Thao tác</th>
              </tr>
            </thead>
            <tbody>
              <tr th:each="user : ${users}">
                <td th:text="${user.id}">1</td>
                <td>
                  <div class="d-flex align-items-center gap-2">
                    <div
                      class="user-avatar"
                      th:text="${#strings.substring(user.username, 0, 1).toUpperCase()}"
                    >
                      A
                    </div>
                    <div>
                      <div class="fw-600" th:text="${user.fullName}">
                        Tên người dùng
                      </div>
                      <small class="text-muted" th:text="${user.username}"
                        >username</small
                      >
                    </div>
                  </div>
                </td>
                <td th:text="${user.email}">email@example.com</td>
                <td th:text="${user.phone}">0123456789</td>
                <td class="text-center">
                  <span
                    class="badge"
                    th:classappend="${user.role == 'ROLE_ADMIN' ? 'bg-danger' : 'bg-primary'}"
                    th:text="${user.role == 'ROLE_ADMIN' ? 'Admin' : 'User'}"
                    >User</span
                  >
                </td>
                <td class="text-center">
                  <span
                    class="status-badge"
                    th:classappend="${user.enabled ? 'status-active' : 'status-inactive'}"
                    th:text="${user.enabled ? 'Hoạt động' : 'Khóa'}"
                    >Hoạt động</span
                  >
                </td>
                <td class="text-end pe-4">
                  <div class="d-flex gap-2 justify-content-end">
                    <a
                      class="btn btn-sm btn-outline-primary"
                      th:href="@{'/admin/user/' + ${user.id} + '/edit'}"
                      title="Chỉnh sửa"
                    >
                      <i class="fas fa-edit"></i>
                    </a>
                    <form
                      th:action="@{'/admin/user/' + ${user.id} + '/delete'}"
                      method="post"
                      style="display: inline-block"
                      onsubmit="return confirm('Xóa người dùng này?');"
                    >
                      <input
                        type="hidden"
                        th:name="${_csrf.parameterName}"
                        th:value="${_csrf.token}"
                      />
                      <button
                        type="submit"
                        class="btn btn-sm btn-outline-danger"
                        title="Xóa"
                      >
                        <i class="fas fa-trash"></i>
                      </button>
                    </form>
                  </div>
                </td>
              </tr>

              <tr th:if="${#lists.isEmpty(users)}">
                <td colspan="7" class="text-center py-5">
                  <div class="text-muted">
                    <i class="fas fa-user-slash fa-3x mb-3"></i>
                    <h6>Không có người dùng</h6>
                    <p class="small mb-0">
                      Nhấn nút "Thêm người dùng" để tạo tài khoản mới
                    </p>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <script th:src="@{/js/bootstrap.bundle.min.js}"></script>
    <script>
      // Auto-hide alerts
      document.addEventListener("DOMContentLoaded", function () {
        const alerts = document.querySelectorAll(".alert");
        alerts.forEach((alert) => {
          setTimeout(() => {
            alert.classList.add("fade");
            setTimeout(() => alert.remove(), 150);
          }, 5000);
        });
      });
    </script>
  </body>
</html>
